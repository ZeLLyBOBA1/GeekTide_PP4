{% extends 'base.html' %}

{% block content %}
    <div id="post-container">
        {% include 'blog/post_list_ajax.html' %}
    </div>
    <div id="loading" style="display: none;">Загрузка...</div>
{% endblock %}

{% block extra_js %}
    <script>
        let page = 2;  // Начиная со второй страницы, так как первая уже загружена
        let loading = false;

        window.onscroll = function() {
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100 && !loading) {
                loading = true;
                document.getElementById('loading').style.display = 'block';

                // Отправляем AJAX-запрос для загрузки новых постов
                fetch(`?page=${page}`, {
                    headers: {
                        "X-Requested-With": "XMLHttpRequest"
                    }
                })
                .then(response => response.text())
                .then(data => {
                    const postContainer = document.getElementById('post-container');
                    postContainer.insertAdjacentHTML('beforeend', data);
                    document.getElementById('loading').style.display = 'none';
                    loading = false;
                    page++;
                })
                .catch(error => {
                    console.error('Ошибка загрузки постов:', error);
                });
            }
        };
    </script>
{% endblock %}